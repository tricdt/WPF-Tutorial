<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:dxt="http://schemas.devexpress.com/winfx/2008/xaml/map/themekeys" xmlns:local="http://schemas.devexpress.com/winfx/2008/xaml/map" xmlns:dxdst="http://schemas.devexpress.com/winfx/2008/xaml/core/themekeys">
  <local:TextToVisibilityConverter x:Key="textToVisibilityConverter" />
  <local:TickMarkVisibilityConverter x:Key="tickMarkVisibilityConverter" />
  <local:MarkerTypeToModelConverter x:Key="MarkerTypeToModelConverter" />
  <local:BoolToVisibilityConverter x:Key="boolToVisibilityConverter" />
  <DataTemplate x:Key="DefaultLegendItemLabelTemplate">
    <TextBlock Text="{Binding ActualText}" />
  </DataTemplate>
  <DataTemplate x:Key="ColorListLegendItemTemplate">
    <StackPanel Margin="3" Orientation="Horizontal">
      <Rectangle Fill="{Binding Fill}" Stroke="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayElementForeground}}" StrokeThickness="1" Width="32" Height="12" />
      <ContentControl ContentTemplate="{Binding LabelTemplate}" Content="{Binding}" Margin="8,0,0,0" VerticalAlignment="Center" />
    </StackPanel>
  </DataTemplate>
  <DataTemplate x:Key="ColorScaleLegendItemTemplate">
    <StackPanel Orientation="Vertical">
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
        <Border Height="18" Width="1" Background="#FF808080" Margin="0,0,4,2" />
        <ContentControl ContentTemplate="{Binding LabelTemplate}" Content="{Binding}" VerticalAlignment="Center" HorizontalAlignment="Stretch" />
      </StackPanel>
      <Rectangle Fill="{Binding Fill}" Height="12" HorizontalAlignment="Stretch" />
    </StackPanel>
  </DataTemplate>
  <DataTemplate x:Key="GradientLegendItemLabelTemplate">
    <ContentControl ContentTemplate="{Binding LabelTemplate}" Content="{Binding}" VerticalAlignment="Center" HorizontalAlignment="Left" />
  </DataTemplate>
  <Style TargetType="Shape" x:Key="legendShapeStyle">
    <Setter Property="Fill" Value="{Binding Fill}" />
    <Setter Property="Stroke" Value="{Binding Stroke}" />
  </Style>
  <Style TargetType="local:MapLegendBase" x:Key="legendStyleBase">
    <Setter Property="Alignment" Value="TopRight" />
    <Setter Property="ItemLabelTemplate" Value="{StaticResource DefaultLegendItemLabelTemplate}" />
  </Style>
  <Style TargetType="Border" x:Key="TickMarkStyle">
    <Setter Property="Background" Value="{Binding Stroke}" />
    <Setter Property="Height" Value="1" />
    <Setter Property="Visibility" Value="{Binding ActualTickMarkVisibility, Converter={StaticResource tickMarkVisibilityConverter}}" />
    <Setter Property="RenderOptions.EdgeMode" Value="Aliased" />
  </Style>
  <Style TargetType="ContentControl" x:Key="LegendLabelStyle">
    <Setter Property="Visibility" Value="{Binding ShowLabel, Converter={StaticResource tickMarkVisibilityConverter}}" />
  </Style>
  <DataTemplate x:Key="InlineSizeLegendItemTemplate">
    <StackPanel Margin="0,6,0,0" Orientation="Horizontal">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="{Binding MaxItemSize}" />
          <ColumnDefinition Width="20" />
        </Grid.ColumnDefinitions>
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="{Binding MarkerSize}" />
            <ColumnDefinition Width="*" />
          </Grid.ColumnDefinitions>
          <ContentPresenter Content="{Binding Path=MarkerType, Converter={StaticResource MarkerTypeToModelConverter}, ConverterParameter={StaticResource legendShapeStyle}}" Grid.Column="1" Height="{Binding MarkerSize}" />
          <Border Style="{StaticResource TickMarkStyle}" HorizontalAlignment="Stretch" VerticalAlignment="Center" Grid.Column="2" Margin="3, 0, -3, 0" />
        </Grid>
        <Border Style="{StaticResource TickMarkStyle}" HorizontalAlignment="Stretch" VerticalAlignment="Center" Grid.Column="1" Margin="3, 0, 0, 0" />
      </Grid>
      <ContentControl ContentTemplate="{Binding LabelTemplate}" Content="{Binding}" Style="{StaticResource LegendLabelStyle}" Margin="6,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left" MinWidth="20" />
    </StackPanel>
  </DataTemplate>
  <DataTemplate x:Key="NestedSizeLegendItemTemplate">
    <local:NestedItemPresentationControl VerticalAlignment="Bottom" />
  </DataTemplate>
  <Style x:Key="{dxdst:DefaultStyleThemeKey FullName=DevExpress.Xpf.Map.NestedItemPresentationControl}" TargetType="local:NestedItemPresentationControl">
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="local:NestedItemPresentationControl">
          <Grid Margin="0,6,0,0" VerticalAlignment="Bottom">
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <ContentControl x:Name="PART_Text" ContentTemplate="{Binding LabelTemplate}" Content="{Binding}" Style="{StaticResource LegendLabelStyle}" Margin="6,0,0,0" VerticalAlignment="Top" HorizontalAlignment="Left" MinWidth="20" Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" />
            <Grid Grid.Row="1" Grid.RowSpan="2">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{Binding MaxItemSize}" />
                <ColumnDefinition Width="20" />
              </Grid.ColumnDefinitions>
              <Grid VerticalAlignment="Top">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Border Style="{StaticResource TickMarkStyle}" HorizontalAlignment="Stretch" VerticalAlignment="Top" Grid.Column="1" />
                <ContentPresenter Content="{Binding Path=MarkerType, Converter={StaticResource MarkerTypeToModelConverter}, ConverterParameter={StaticResource legendShapeStyle}}" Grid.ColumnSpan="2" Width="{Binding MarkerSize}" Height="{Binding MarkerSize}" VerticalAlignment="Center" />
              </Grid>
              <Border Style="{StaticResource TickMarkStyle}" HorizontalAlignment="Stretch" VerticalAlignment="Top" Grid.Column="1" />
            </Grid>
          </Grid>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
  </Style>
  <Style TargetType="ItemsControl" x:Key="sizeLegendItemsControlStyle">
    <Style.Triggers>
      <DataTrigger Binding="{Binding Path=Type, RelativeSource={RelativeSource Mode=TemplatedParent}}" Value="Inline">
        <Setter Property="ItemTemplate" Value="{StaticResource InlineSizeLegendItemTemplate}" />
        <Setter Property="ItemsPanel">
          <Setter.Value>
            <ItemsPanelTemplate>
              <StackPanel />
            </ItemsPanelTemplate>
          </Setter.Value>
        </Setter>
      </DataTrigger>
      <DataTrigger Binding="{Binding Path=Type, RelativeSource={RelativeSource Mode=TemplatedParent}}" Value="Nested">
        <Setter Property="ItemTemplate" Value="{StaticResource NestedSizeLegendItemTemplate}" />
        <Setter Property="ItemsPanel">
          <Setter.Value>
            <ItemsPanelTemplate>
              <local:NestedSizeLegendPanel />
            </ItemsPanelTemplate>
          </Setter.Value>
        </Setter>
      </DataTrigger>
    </Style.Triggers>
  </Style>
  <Style x:Key="{dxdst:DefaultStyleThemeKey FullName=DevExpress.Xpf.Map.ColorListLegend}" TargetType="local:ColorListLegend" BasedOn="{StaticResource legendStyleBase}">
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="local:ColorListLegend">
          <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" Visibility="{Binding Path=ActualVisibility, RelativeSource={RelativeSource TemplatedParent}}" CornerRadius="{DynamicResource {dxt:MapThemeKey ResourceKey=OverlayRadius}}">
            <StackPanel Orientation="Vertical">
              <TextBlock Text="{TemplateBinding Header}" FontSize="24" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
              <TextBlock Text="{TemplateBinding Description}" FontSize="12" Padding="0,0,0,15" TextWrapping="Wrap" HorizontalAlignment="Left" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
              <local:LabeledItemsControl x:Name="PART_ItemsControl" ItemTemplate="{TemplateBinding ItemTemplate}" ItemLabelTemplate="{TemplateBinding ItemLabelTemplate}" />
            </StackPanel>
          </Border>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
    <Setter Property="ItemTemplate" Value="{StaticResource ColorListLegendItemTemplate}" />
    <Setter Property="Margin" Value="16" />
    <Setter Property="Padding" Value="16" />
    <Setter Property="Background" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayBackground}}" />
    <Setter Property="Foreground" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayElementForeground}}" />
  </Style>
  <Style x:Key="{dxdst:DefaultStyleThemeKey FullName=DevExpress.Xpf.Map.SizeLegend}" TargetType="local:SizeLegend" BasedOn="{StaticResource legendStyleBase}">
    <Setter Property="Template">
      <Setter.Value>
        <ControlTemplate TargetType="local:SizeLegend">
          <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" Visibility="{Binding Path=ActualVisibility, RelativeSource={RelativeSource TemplatedParent}}" CornerRadius="{DynamicResource {dxt:MapThemeKey ResourceKey=OverlayRadius}}">
            <StackPanel Orientation="Vertical">
              <TextBlock Text="{TemplateBinding Header}" FontSize="24" Padding="0,0,0,15" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
              <TextBlock Text="{TemplateBinding Description}" FontSize="12" Padding="0,0,0,15" TextWrapping="Wrap" HorizontalAlignment="Left" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
              <local:LabeledItemsControl Style="{StaticResource sizeLegendItemsControlStyle}" ItemLabelTemplate="{TemplateBinding ItemLabelTemplate}" x:Name="PART_ItemsControl" />
            </StackPanel>
          </Border>
        </ControlTemplate>
      </Setter.Value>
    </Setter>
    <Setter Property="Margin" Value="16" />
    <Setter Property="Padding" Value="16" />
    <Setter Property="Background" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayBackground}}" />
    <Setter Property="Foreground" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayElementForeground}}" />
    <Setter Property="ItemFill" Value="Transparent" />
    <Setter Property="ItemStroke" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayElementForeground}}" />
  </Style>
  <ControlTemplate x:Key="ColorScaleLegendTemplate" TargetType="local:ColorScaleLegend">
    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" Visibility="{Binding Path=ActualVisibility, RelativeSource={RelativeSource TemplatedParent}}" CornerRadius="{DynamicResource {dxt:MapThemeKey ResourceKey=OverlayRadius}}">
      <StackPanel Orientation="Vertical">
        <TextBlock Text="{TemplateBinding Header}" FontSize="24" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
        <TextBlock Text="{TemplateBinding Description}" FontSize="12" Padding="0,0,0,15" TextWrapping="Wrap" HorizontalAlignment="Left" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
        <local:LabeledItemsControl HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ItemTemplate="{TemplateBinding ItemTemplate}" ItemLabelTemplate="{TemplateBinding ItemLabelTemplate}" x:Name="PART_ItemsControl">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <local:ColorScalePanel HorizontalAlignment="Stretch" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
        </local:LabeledItemsControl>
      </StackPanel>
    </Border>
  </ControlTemplate>
  <ControlTemplate x:Key="GradientColorScaleLegendTemplate" TargetType="local:ColorScaleLegend">
    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" Visibility="{Binding Path=ActualVisibility, RelativeSource={RelativeSource TemplatedParent}}" CornerRadius="{DynamicResource {dxt:MapThemeKey ResourceKey=OverlayRadius}}">
      <StackPanel Orientation="Vertical">
        <TextBlock Text="{TemplateBinding Header}" FontSize="24" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
        <TextBlock Text="{TemplateBinding Description}" FontSize="12" Padding="0,0,0,15" TextWrapping="Wrap" HorizontalAlignment="Left" Visibility="{Binding Text, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource textToVisibilityConverter}}" />
        <local:GradientPanel x:Name="gradientPanel" Margin="0,0,0,15">
          <local:LabeledItemsControl HorizontalAlignment="Stretch" VerticalAlignment="Stretch" ItemTemplate="{TemplateBinding ItemTemplate}" ItemLabelTemplate="{TemplateBinding ItemLabelTemplate}" x:Name="PART_ItemsControl">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <local:GradientItemsPanel />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
          </local:LabeledItemsControl>
          <Rectangle x:Name="PART_GradientRect" HorizontalAlignment="Stretch" Height="12" Fill="{Binding Path=Fill, ElementName=gradientPanel}" />
        </local:GradientPanel>
      </StackPanel>
    </Border>
  </ControlTemplate>
  <Style x:Key="{dxdst:DefaultStyleThemeKey FullName=DevExpress.Xpf.Map.ColorScaleLegend}" TargetType="local:ColorScaleLegend" BasedOn="{StaticResource legendStyleBase}">
    <Setter Property="Margin" Value="16" />
    <Setter Property="Padding" Value="16" />
    <Setter Property="Background" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayBackground}}" />
    <Setter Property="Foreground" Value="{DynamicResource {dxt:MapBrushesThemeKey ResourceKey=OverlayElementForeground}}" />
    <Style.Triggers>
      <Trigger Property="EnableGradientScale" Value="false">
        <Setter Property="Template" Value="{StaticResource ColorScaleLegendTemplate}" />
        <Setter Property="ItemTemplate" Value="{StaticResource ColorScaleLegendItemTemplate}" />
        <Setter Property="MinWidth" Value="300" />
      </Trigger>
      <Trigger Property="EnableGradientScale" Value="true">
        <Setter Property="Template" Value="{StaticResource GradientColorScaleLegendTemplate}" />
        <Setter Property="ItemTemplate" Value="{StaticResource GradientLegendItemLabelTemplate}" />
        <Setter Property="MinWidth" Value="50" />
      </Trigger>
    </Style.Triggers>
  </Style>
</ResourceDictionary>